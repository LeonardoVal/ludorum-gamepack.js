//! ludorum-gamepack 0.1.0

!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["creatartis-base","ludorum"],b):"object"==typeof module&&module.exports?module.exports=b(require("creatartis-base"),require("ludorum")):a.ludorum_gamepack=b(a.base,a.ludorum)}(this,function a(b,c){"use strict";var d=b.declare,e=b.obj,f=b.copy,g=(b.raise,b.raiseIf),h=b.Iterable,i=b.iterable,j=c.Game,k=c.games,l=c.utils.Checkerboard,m=c.utils.CheckerboardFromString,n=c.players.UserInterface,o={__name__:"ludorum-gamepack",__init__:a,__dependencies__:[b,c]};return k.ConnectFour=d(k.ConnectionGame,{name:"ConnectFour",height:6,width:7,lineLength:4,players:["Yellow","Red"],moves:function(){var a=null;if(!this.result()){for(var b=[],c=this.board.string,d=(this.height-1)*this.width,e=0;e<c.length;++e)"."===c.charAt(d+e)&&b.push(e);b.length>0&&(a={},a[this.activePlayer()]=b)}return a},next:function(a){for(var b=this.activePlayer(),c=this.board.string,d=+a[b],e=this.height,f=this.width,g=0;e>g;++g)if("."===c.charAt(g*f+d))return new this.constructor(this.opponent(),this.board.place([g,d],b===this.players[0]?"0":"1"));throw new Error("Invalid move "+JSON.stringify(a)+"!")},display:function(a){g(!(a&&a instanceof n.BasicHTMLInterface),"Unsupported UI!");{var b=this.moves(),c=this.activePlayer();this.board}b=b&&b[c];var d=this.board.renderAsHTMLTable(a.document,a.container,function(d){d.className="."===d.square?"ludorum-empty":"ludorum-player"+d.square,d.innerHTML="."===d.square?"&nbsp;":"&#x25CF;",b&&b.indexOf(d.coord[1])>=0&&(d.move=d.coord[1],d.activePlayer=c,d.onclick=a.perform.bind(a,d.move,c))});return d.insertBefore(a.build(a.document.createElement("colgroup"),h.repeat(["col"],this.board.width).toArray()),d.firstChild),a},__serialize__:function(){return[this.name,this.activePlayer(),this.board.string]}}),k.Othello=d(j,{name:"Othello",constructor:function(a,b){if(j.call(this,a),this.board=this.makeBoard.apply(this,b||[]),!this.moves()){var c=this.opponent();this.moves(c)&&(this.activePlayers=[c])}},"dual makeBoard":function(a,b,c){return a=isNaN(a)?8:+a,b=isNaN(b)?8:+b,g(4>a||4>b||a%2||b%2,"An Othello board must have even dimensions greater than 3."),"string"==typeof c?new m(a,b,c):new m(a,b).__place__([a/2,b/2-1],"W").__place__([a/2-1,b/2],"W").__place__([a/2,b/2],"B").__place__([a/2-1,b/2-1],"B")},players:["Black","White"],lines:function(a){return function(b,c){var d=b+"x"+c,e=a[d];return"undefined"==typeof e&&(e=a[d]=new l(b,c).lines().map(function(a){return a.toArray()},function(a){return a.length>2}).toArray()),e}}({}),__MOVE_REGEXPS__:{Black:[/\.W+B/g,/BW+\./g],White:[/\.B+W/g,/WB+\./g]},moves:function(a){if(!a&&this.__moves__)return this.__moves__;a=a||this.activePlayer();var b=this.board,c={},d=this.__MOVE_REGEXPS__[a];this.lines(b.height,b.width).forEach(function(a){d.forEach(function(d){b.asString(a).replace(d,function(b,d){var e="."===b.charAt(0)?a[d]:a[b.length-1+d];return c[e]=e,b})})});var f=[];for(var g in c)f.push(c[g]);return this.__moves__=f.length>0?e(a,f):null},next:function(a){var b,c,d=this.board.clone(),e=this.activePlayer();if(!a.hasOwnProperty(e)||!d.isValidCoord(a[e]))throw new Error("Invalid moves "+JSON.stringify(a)+"!");return e==this.players[0]?(b="B",c=/^W+B/):(b="W",c=/^B+W/),d.walks(a[e],l.DIRECTIONS.EVERY).forEach(function(a){var e=c.exec(d.asString(a).substr(1));e&&a.toArray().slice(0,e[0].length).forEach(function(a){d.__place__(a,b)})}),new this.constructor(this.opponent(),[d.height,d.width,d.string])},result:function(){if(this.moves())return null;var a={W:-1,B:1},b=i(this.board.string).map(function(b){return a[b]||0}).sum();return this.zerosumResult(b,"Black")},resultBounds:function(){var a=this.board.width*this.board.height;return[-a,+a]},display:function(a){g(!(a&&a instanceof n.BasicHTMLInterface),"Unsupported UI!");var b=this.moves(),c=this.activePlayer(),d=this.board,e={B:"ludorum-square-Black",W:"ludorum-square-White",".":"ludorum-square-empty"};return b=b&&b[c].map(JSON.stringify),d.renderAsHTMLTable(a.document,a.container,function(d){d.className=e[d.square],d.innerHTML="&nbsp;";var f=JSON.stringify(d.coord);b&&b.indexOf(f)>=0&&(d.move=d.coord,d.activePlayer=c,d.className="ludorum-square-move",d.onclick=a.perform.bind(a,d.move,c))}),a},__serialize__:function(){var a=this.board;return[this.name,this.activePlayer(),[a.height,a.width,a.string]]},"static heuristics":{heuristicFromWeights:function(a){var b=a.length,c=i(a).map(Math.abs).sum(),d=function(d,e){var f=d.board;return g(f.height*f.width!==b,"Wrong amount of weights!"),f.weightedSum(a,{W:"W"===e.charAt(0)?1:-1,B:"B"===e.charAt(0)?1:-1})/c};return d.weights=a,d},heuristicFromSymmetricWeights:function(a,b,c){b=isNaN(b)?8:0|b,c=isNaN(c)?8:0|c;var d=Math.ceil(b/2);return g(d*Math.ceil(c/2)>a.length,"Not enough weights!"),a=h.range(c).map(function(e){var f=c/2>e?e:c-e-1,g=f*d,h=(f+1)*d;return a.slice(g,h).concat(a.slice(g,h-b%2).reverse())}).flatten().toArray(),this.heuristicFromWeights(a)},pieceRatio:function(a,b){var c=0,d=0;return i(a.board.string).forEach(function(a){"."!==a&&(a===b.charAt(0)?++c:++d)}),(c-d)/(c+d)||0},mobilityRatio:function(a,b){var c=a.opponent(b),d=a.moves(b),e=a.moves(c),f=d&&d[b]&&d[b].length||0,g=e&&e[c]&&e[c].length||0;return(f-g)/(f+g)||0}}}),k.Mancala=d(j,{name:"Mancala",constructor:function(a,b){j.call(this,a),this.board=b||this.makeBoard()},makeBoard:function(a,b){a=isNaN(a)?4:+a,b=isNaN(b)?6:+b;for(var c=[],d=0;2>d;d++){for(var e=0;b>e;e++)c.push(a);c.push(0)}return c},players:["North","South"],emptyCapture:!1,countRemainingSeeds:!0,store:function(a){switch(this.players.indexOf(a)){case 0:return this.board.length/2-1;case 1:return this.board.length-1;default:throw new Error("Invalid player "+a+".")}},houses:function(a){switch(this.players.indexOf(a)){case 0:return h.range(0,this.board.length/2-1).toArray();case 1:return h.range(this.board.length/2,this.board.length-1).toArray();default:throw new Error("Invalid player "+a+".")}},oppositeHouse:function(a,b){var c=this.houses(a),d=this.houses(this.opponent(a)),e=c.indexOf(b);return 0>e?e:d.reverse()[e]},nextSquare:function(a,b){do b=(b+1)%this.board.length;while(b===this.store(this.opponent(a)));return b},moves:function(){if(this.result())return null;var a=this.board,b={},c=this.activePlayer();return b[c]=this.houses(c).filter(function(b){return a[b]>0}),b[c].length>0?b:null},scores:function(){var a=this,b=this.board,c=this.players.map(function(c){return i(a.houses(c)).map(function(a){return b[a]}).sum()});if(c[0]>0&&c[1]>0)return null;var d={};return this.players.forEach(function(e,f){d[e]=b[a.store(e)]+a.countRemainingSeeds*c[f]}),d},result:function(){var a=this.scores(),b=this.players;return a&&this.zerosumResult(a[b[0]]-a[b[1]],b[0])},next:function(a){var b,c,d=this.activePlayer(),e=+a[d],f=this.board.slice(0),h=f[e],i=!1;for(g(1>h,"Invalid move ",e," for game ",this),f[e]=0;h>0;h--)e=this.nextSquare(d,e),f[e]++;return i=e==this.store(d),i||(c=this.oppositeHouse(d,e),c>=0&&1==f[e]&&f[c]>0&&(b=this.store(d),f[b]++,f[e]=0,this.emptyCapture||(f[b]+=f[c],f[c]=0))),new this.constructor(i?d:this.opponent(),f)},resultBounds:function(){var a=i(this.board).sum();return[-a,+a]},__serialize__:function(){return[this.name,this.activePlayer(),this.board.slice()]},identifier:function(){return this.activePlayer().charAt(0)+this.board.map(function(a){return("00"+a.toString(36)).substr(-2)}).join("")},printBoard:function(){var a=this,c=b.Text.lpad,d=this.players[0],e=this.houses(d).map(function(b){return c(""+a.board[b],2,"0")}).reverse(),f=c(""+this.board[this.store(d)],2,"0"),g=this.players[1],h=this.houses(g).map(function(b){return c(""+a.board[b],2,"0")}),i=c(""+this.board[this.store(g)],2,"0");return"   "+e.join(" | ")+"   \n"+f+" ".repeat(2*e.length+3*(e.length-1)+2)+i+"\n   "+h.join(" | ")+"   "},display:function(a){return g(!(a&&a instanceof n.BasicHTMLInterface),"Unsupported UI!"),this.__displayHTML__(a)},__displayHTML__:function(a){var c,d,e=this,f=this.players[0],g=this.players[1],h=this.activePlayer(),i=this.moves(),j=function(c,d,f){var g={id:"ludorum-square-"+d,className:f?"ludorum-square-store":"ludorum-square-house",square:e.board[d],innerHTML:b.Text.escapeXML(e.board[d])};return!f&&i&&i[h]&&i[h].indexOf(d)>=0&&(g.move=d,g.activePlayer=h,g.className="ludorum-square-move",c.onclick=g.onclick=a.perform.bind(a,g.move,h)),c["ludorum-data"]=g,c.id=g.id,c.className=g.className,c.innerHTML=g.innerHTML,c.setAttribute("rowspan",f?2:1),c};return a.container.appendChild(c=document.createElement("table")),c.appendChild(d=document.createElement("tr")),d.appendChild(j(document.createElement("td"),this.store(f),!0)),this.houses(f).reverse().forEach(function(a){d.appendChild(j(document.createElement("td"),a,!1))}),d.appendChild(j(document.createElement("td"),this.store(g),!0)),c.appendChild(d=document.createElement("tr")),this.houses(g).forEach(function(a){d.appendChild(j(document.createElement("td"),a,!1))}),a},"static heuristics":{heuristicFromWeights:function(a){function b(b,d){var e,f=0;switch(b.players.indexOf(d)){case 0:e=1;break;case 1:e=-1;break;default:throw new Error("Invalid player "+d+".")}return i(b.board).map(function(b,c){return f+=b,b*a[c]}).sum()/c/f*e}var c=i(a).map(Math.abs).sum();return b.weights=a,b}},"":function(){this.makeBoard=this.prototype.makeBoard,this.heuristics.defaultHeuristic=this.heuristics.heuristicFromWeights([1,1,1,1,1,1,5,-1,-1,-1,-1,-1,-1,-5])}}),k.Colograph=d(j,{name:"Colograph",constructor:function(a){j.call(this,a?a.activePlayer:void 0),b.initialize(this,a).object("colours",{defaultValue:{}}).array("edges",{defaultValue:[[1,3],[2],[3],[]]}).array("shapes",{defaultValue:["circle","triangle","square","star"]}).number("scoreSameShape",{defaultValue:-1,coerce:!0}).number("scoreDifferentShape",{defaultValue:-1,coerce:!0})},players:["Red","Blue"],score:function(){var a={},b=this.shapes,c=this.colours,d=this.scoreSameShape,e=this.scoreDifferentShape,f=this.edges.length;return this.players.forEach(function(b){a[b]=f}),i(this.edges).forEach(function(f,g){f.forEach(function(f){var h=g+","+f;c.hasOwnProperty(h)&&(a[c[h]]+=b[g]===b[f]?d:e)})}),a},result:function(){if(this.moves())return null;var a=this.score(),b=this.players;return this.zerosumResult(a[b[0]]-a[b[1]],b[0])},moves:function(){for(var a=(this.colours,[]),b=0;b<this.edges.length;b++)this.colours.hasOwnProperty(b)||a.push(b);return a.length<1?null:e(this.activePlayer(),a)},next:function(a){var b=this.activePlayer(),c=+a[b]>>0;g(0>c||c>=this.colours.length,"Invalid move: node ",c," does not exist in ",this,"."),g(this.colours[c]>=0,"Invalid move: node ",c," has already been coloured in ",this,".");var d=f(e(c,b),this.colours);return this.edges[c].forEach(function(a){d[a]===b&&(d[c+","+a]=b)}),this.edges.forEach(function(a,e){e!==c&&a.indexOf(c)>=0&&d[e]===b&&(d[e+","+c]=b)}),new this.constructor({activePlayer:this.opponent(b),colours:d,edges:this.edges,shapes:this.shapes,scoreSameShape:this.scoreSameShape,scoreDifferentShape:this.scoreDifferentShape})},__serialize__:function(){return[this.name,{activePlayer:this.activePlayer(),colours:this.colours,edges:this.edges,shapes:this.shapes,scoreSameShape:this.scoreSameShape,scoreDifferentShape:this.scoreDifferentShape}]},edgeColour:function(a,b){var c=this.edges[a].indexOf(b)>=0||this.edges[b].indexOf(a)>=0,d=this.colours[a],e=this.colours[b];return c&&d>=0&&d===e?d:-1},"static heuristics":{scoreDifference:function(a,b){var c=a.score(),d=0;for(var e in c)d+=e===b?c[e]:-c[e];return d/a.edges.length/2}},"static randomGraph":function(a,b,c){a=Math.max(2,+a>>0),b=Math.max(a-1,+b>>0);for(var d,e,f=basis.iterables.range(a-1).map(function(b){return c.split(1,basis.iterables.range(b+1,a).toArray())}).toArray(),g=b-(a-1);g>0;g--)d=c.choice(f),d[1].length>0&&(e=c.split(1,d[1]),d[0].push(e[0][0]),d[1]=e[1],g--);return f=f.map(function(a){return a[0]}),f.push([]),f},"static randomGame":function(){params=b.initialize({},params).object("random",{defaultValue:randomness.DEFAULT}).integer("nodeCount",{defaultValue:8,coerce:!0}).integer("edgeCount",{defaultValue:11,coerce:!0}).integer("shapeCount",{defaultValue:4,coerce:!0,minimum:1,maximum:4}).subject;var a=["circle","triangle","square","star"];return new Colograph({edges:this.randomGraph(params.nodeCount,params.edgeCount,params.random),shapes:params.random.randoms(params.nodeCount,0,params.shapeCount).map(function(b){return a[0|b]}),scoreSameShape:1})},"static KineticUI":d(n,{constructor:function(a){n.call(this,a),initialize(this,a).string("container",{defaultValue:"colograph-container"}).object("Kinetic",{defaultValue:window.Kinetic}).integer("canvasRadius",{defaultValue:0/0,coerce:!0}).integer("nodeRadius",{defaultValue:15,coerce:!0}).array("playerColours",{defaultValue:["red","blue"]}),isNaN(this.canvasRadius)&&(this.canvasRadius=.6*Math.min(screen.width,screen.height)>>1);var b=this.stage=new Kinetic.Stage({container:this.container,width:2*this.canvasRadius,height:2*this.canvasRadius}),c=this.layer=new Kinetic.Layer({clearBeforeDraw:!0,offsetX:-this.canvasRadius,offsetY:-this.canvasRadius}),d=this.match.state();b.add(c),setInterval(b.draw.bind(b),1e3/30),c.destroyChildren(),this.edges={},this.nodes={},this.drawEdges(d),this.drawNodes(d)},drawEdges:function(a){var b=2*Math.PI/a.edges.length,c=this.canvasRadius-2*this.nodeRadius,d=this;a.edges.forEach(function(a,e){a.forEach(function(a){var f=new d.Kinetic.Line({points:[c*Math.cos(b*e),c*Math.sin(b*e),c*Math.cos(b*a),c*Math.sin(b*a)],stroke:"black",strokeWidth:2});d.edges[e+","+a]=f,d.layer.add(f)})})},drawNodes:function(a){var b=2*Math.PI/a.edges.length,c=this.canvasRadius-2*this.nodeRadius,d=this;a.edges.forEach(function(e,f){var g,h=c*Math.cos(b*f),i=c*Math.sin(b*f);switch(a.shapes[f]){case"square":g=d.drawSquare(h,i,d.nodeRadius,f);break;case"triangle":g=d.drawTriangle(h,i,d.nodeRadius,f);break;case"star":g=d.drawStar(h,i,d.nodeRadius,f);break;default:g=d.drawCircle(h,i,d.nodeRadius,f)}g.on("mouseover",function(){g.setScale(1.2)}),g.on("mouseout",function(){g.setScale(1)}),g.on("click tap",function(){d.perform(f)}),g.setRotation(2*Math.random()*Math.PI),d.nodes[f]=g,d.layer.add(g)})},drawCircle:function(a,b,c){return new this.Kinetic.Circle({x:a,y:b,radius:c,fill:"white",stroke:"black",strokeWidth:2})},drawSquare:function(a,b,c){return new this.Kinetic.Rect({x:a,y:b,width:2*c,height:2*c,offsetX:c,offsetY:c,fill:"white",stroke:"black",strokeWidth:2})},drawStar:function(a,b,c){return new Kinetic.Star({numPoints:5,x:a,y:b,innerRadius:.6*c,outerRadius:1.5*c,fill:"white",stroke:"black",strokeWidth:2})},drawTriangle:function(a,b,c){return new Kinetic.RegularPolygon({sides:3,x:a,y:b,radius:1.25*c,fill:"white",stroke:"black",strokeWidth:2})},display:function(a){this.updateEdges(a),this.updateNodes(a)},updateEdges:function(a){var b=this;a.edges.forEach(function(c,d){c.forEach(function(c){var e=d+","+c;b.edges[e].setStroke(a.colours[e]||"black")})})},updateNodes:function(a){var b=this;a.edges.forEach(function(c,d){var e=a.colours[d];e&&(b.nodes[d].setFill(e),b.nodes[d].off("mouseover mouseout click tap"))})}})}),o});
//# sourceMappingURL=ludorum-gamepack.min.js.map