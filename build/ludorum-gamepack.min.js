//! ludorum-gamepack 0.1.2

(function(a){"use strict";"function"==typeof define&&define.amd?define(["creatartis-base","sermat","ludorum"],a):"object"==typeof exports&&module.exports?module.exports=a(require("creatartis-base"),require("sermat"),require("ludorum")):this["ludorum-gamepack"]=a(this.base,this.Sermat,this.ludorum)}).call(this,function a(b,c,d){"use strict";var e={__package__:"ludorum-gamepack",__name__:"ludorum_gamepack",__init__:a,__dependencies__:[b,c,d],__SERMAT__:{include:[b,d]}},f={base:b,Sermat:c,ludorum:d};return function(){this["ludorum-game-connect4"]=function a(b,c,d){var e=b.declare,f=(b.raise,b.raiseIf),g=(b.Iterable,b.iterable,d.Game,d.players.UserInterface,{__package__:"ludorum-game-connect4",__name__:"ludorum_game_connect4",__init__:a,__dependencies__:[b,c,d],__SERMAT__:{include:[b,d]}}),h=g.ConnectFour=e(d.games.ConnectionGame,{name:"ConnectFour",height:6,width:7,lineLength:4,players:["Yellow","Red"],moves:function(){var a=null;if(!this.result()){for(var b=[],c=this.board.string,d=(this.height-1)*this.width,e=0;e<c.length;++e)"."===c.charAt(d+e)&&b.push(e);b.length>0&&(a={},a[this.activePlayer()]=b)}return a},next:function(a,b,c){f(b,"Haps are not required (given ",b,")!");for(var d=this.activePlayer(),e=this.board.string,g=+a[d],h=this.height,i=this.width,j=0;j<h;++j)if("."===e.charAt(j*i+g)){var k=d===this.players[0]?"0":"1";return c?(this.activatePlayers(this.opponent()),this.board.__place__([j,g],k),delete this.__moves__,delete this.__result__,this):new this.constructor(this.opponent(),this.board.place([j,g],k))}throw new Error("Invalid move "+JSON.stringify(a)+"!")},result:function(){for(var a=this.lineLength,b=this.board.asStrings(this.__lines__(this.height,this.width,a)).join(" "),c=0;c<this.players.length;++c)if(b.indexOf(c.toString(36).repeat(a))>=0)return this.victory([this.players[c]]);return b.indexOf(".")<0?this.tied():null},"static __SERMAT__":{identifier:"ConnectFour",serializer:function(a){return d.games.ConnectionGame.__SERMAT__.serializer(a)}}});return d.games.ConnectFour=h,h.__SERMAT__.identifier=g.__package__+"."+h.__SERMAT__.identifier,g.__SERMAT__.include.push(h),c.include(g),g}(b,c,d)}.call(f),function(){this["ludorum-game-colograph"]=function a(b,c,d){var e=b.declare,f=b.obj,g=(b.copy,b.raise,b.raiseIf),h=b.Iterable,i=b.iterable,j=d.Game,k=(d.players.UserInterface,{__package__:"ludorum-game-colograph",__name__:"ludorum_game_colograph",__init__:a,__dependencies__:[b,c,d],__SERMAT__:{include:[b,d]}}),l=k.Colograph=e(j,{name:"Colograph",constructor:function(a){j.call(this,a?a.activePlayer:void 0),b.initialize(this,a).object("colours",{defaultValue:{}}).array("edges",{defaultValue:[[1,3],[2],[3],[]]}).array("shapes",{defaultValue:["circle","triangle","square","star"]}).number("scoreSameShape",{defaultValue:-1,coerce:!0}).number("scoreDifferentShape",{defaultValue:-1,coerce:!0})},players:["Red","Blue"],score:function(){var a={},b=this.shapes,c=this.colours,d=this.scoreSameShape,e=this.scoreDifferentShape,f=this.edges.length;return this.players.forEach(function(b){a[b]=f}),i(this.edges).forEach(function(f,g){f.forEach(function(f){var h=g+","+f;c.hasOwnProperty(h)&&(a[c[h]]+=b[g]===b[f]?d:e)})}),a},result:function(){if(this.moves())return null;var a=this.score(),b=this.players;return this.zerosumResult(a[b[0]]-a[b[1]],b[0])},moves:function(){for(var a=this.colours,b=[],c=0,d=this.edges.length;c<d;c++)a.hasOwnProperty(c)||b.push(c);return b.length<1?null:f(this.activePlayer(),b)},next:function(a,b,c){g(b,"Haps are not required (given ",b,")!");var d=this.activePlayer(),e=0|a[d];g(e<0||e>=this.edges.length,"Invalid move: node ",e," does not exist in ",this,"."),g(this.colours.hasOwnProperty(e),"Invalid move: node ",e," has already been coloured in ",this,".");var h=Object.assign(f(e,d),this.colours);this.edges[e].forEach(function(a){h[a]===d&&(h[e+","+a]=d)}),this.edges.forEach(function(a,b){b!==e&&a.indexOf(e)>=0&&h[b]===d&&(h[b+","+e]=d)});var i={activePlayer:this.opponent(d),colours:h,edges:this.edges,shapes:this.shapes,scoreSameShape:this.scoreSameShape,scoreDifferentShape:this.scoreDifferentShape};return c?(this.constructor(i),this):new this.constructor(i)},"static __SERMAT__":{identifier:"Colograph",serializer:function(a){return[{activePlayer:a.activePlayer(),colours:a.colours,edges:a.edges,shapes:a.shapes,scoreSameShape:a.scoreSameShape,scoreDifferentShape:a.scoreDifferentShape}]}},edgeColour:function(a,b){var c=this.edges[a].indexOf(b)>=0||this.edges[b].indexOf(a)>=0,d=this.colours[a],e=this.colours[b];return c&&d>=0&&d===e?d:-1},"static randomGraph":function(a,b,c){a=Math.max(2,+a>>0),b=Math.max(a-1,+b>>0);for(var d,e,f=h.range(a-1).map(function(b){return c.split(1,h.range(b+1,a).toArray())}).toArray(),g=b-(a-1);g>0;g--)d=c.choice(f),d[1].length>0&&(e=c.split(1,d[1]),d[0].push(e[0][0]),d[1]=e[1],g--);return f=f.map(function(a){return a[0]}),f.push([]),f},"static randomGame":function(a){return a=b.initialize({},a).object("random",{defaultValue:b.Randomness.DEFAULT}).integer("nodeCount",{defaultValue:8,coerce:!0}).integer("edgeCount",{defaultValue:11,coerce:!0}).integer("shapeCount",{defaultValue:4,coerce:!0,minimum:1,maximum:4}).array("shapes",{defaultValue:["circle","triangle","square","star"]}).subject,new this({edges:this.randomGraph(a.nodeCount,a.edgeCount,a.random),shapes:a.random.randoms(a.nodeCount,0,a.shapeCount).map(function(b){return a.shapes[0|b]}),scoreSameShape:1})}});return d.games.Colograph=l,l.__SERMAT__.identifier=k.__package__+"."+l.__SERMAT__.identifier,k.__SERMAT__.include.push(l),c.include(k),Object.assign(l.prototype,{circularArrangement:function(a){a=a||200;var b=2*Math.PI/this.edges.length;return this.edges.map(function(c,d){return[Math.round(a*Math.cos(b*d)),Math.round(a*Math.sin(b*d))]})},playerColour:function(a,b){return b=b||this.playerColours,b&&b[a]||a&&(a+"").toLowerCase()||""},__svgEnvelope__:function(a,b,c){return'<?xml version="1.0" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg height="'+b+'px" width="'+a+'px" version="1.1"\nxmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n'+(Array.isArray(c)?c.join("\n\t"):c)+"\n</svg>"},__svgStyles__:function(a){var b=this;return'<style type="text/css" ><![CDATA[\n\t.blank-node { stroke:black; stroke-width:2px; fill:white; }\n\t.blank-node:hover { stroke-width:4px; }\n\t.blank-edge { stroke:black; stroke-width:2px; }\n'+this.players.map(function(c){var d=b.playerColour(c,a);return"\t."+d+"-node { stroke:black; stroke-width:2px; fill:"+d+"}\n\t."+d+"-edge { stroke:"+d+"; stroke-width:2px }"}).join("\n")+"\t]]>\n\t</style>\n"},__svgDefs__:function(a){return a=a||30,["<defs>",this.__svgDefCircle__(a),this.__svgDefSquare__(a),this.__svgDefStar__(a),this.__svgDefTriangle__(a),this.__svgDefPentagon__(a),this.__svgDefHexagon__(a),"</defs>"].join("\n")},__svgDefPolygon__:function(a,b,c){return b=b.map(function(a){return[a[0]*c,a[1]*c]}),'\t<polygon id="'+a+'-node" points="'+b.join(" ")+'"/>'},__svgDefCircle__:function(a){return'\t<circle id="circle-node" r="'+a/2+'px" cx="0" cy="0"/>'},__svgDefSquare__:function(a){return'\t<rect id="square-node" width="'+a+'px" height="'+a+'px" x="-'+a/2+'" y="-'+a/2+'"/>'},__svgDefTriangle__:function(a){return this.__svgDefPolygon__("triangle",[[-.5,.44],[0,-.44],[.5,.44]],a)},__svgDefStar__:function(a){return this.__svgDefPolygon__("star",[[0,-.48],[.12,-.1],[.5,-.1],[.2,.1],[.3,.48],[0,.26],[-.3,.48],[-.2,.1],[-.5,-.1],[-.12,-.1]],a)},__svgDefPentagon__:function(a){return this.__svgDefPolygon__("pentagon",[[0,-.48],[.5,-.1],[.3,.48],[-.3,.48],[-.5,-.1]],a)},__svgDefHexagon__:function(a){return this.__svgDefPolygon__("pentagon",[[0,-.5],[.42,-.24],[.42,.24],[0,.5],[-.42,.24],[-.42,-.24]],a)},toSVG:function(a,b,c,d){a=a||400,b=b||400,d=d||this.circularArrangement(Math.max(a,b)/2.5);var e=this,f=this.colours,g=[this.__svgStyles__(),this.__svgDefs__(c),'\t<g id="colograph" transform="translate('+a/2+","+b/2+')">'];this.edges.forEach(function(a,b){var c=d[b];a.forEach(function(a){var h=d[a],i=f[b+","+a],j=(e.playerColour(i)||"blank")+"-edge";g.push('\t<line class="'+j+'" x1="'+c[0]+'" y1="'+c[1]+'" x2="'+h[0]+'" y2="'+h[1]+'"/>')})});var h=this.shapes;return this.edges.forEach(function(a,b){var c=d[b],i=f[b],j=(e.playerColour(i)||"blank")+"-node";g.push('<use id="node'+b+'" xlink:href="#'+h[b]+'-node" transform="translate('+c.join(",")+')" class="'+j+'" data-ludorum-move="'+b+'"/>')}),g.push("\t</g>"),this.__svgEnvelope__(a,b,g)}}),l.heuristics={scoreDifference:function(a,b){var c=a.score(),d=0;for(var e in c)d+=e===b?c[e]:-c[e];return d/a.edges.length/2}},k}(b,c,d)}.call(f),function(){this["ludorum-game-mancala"]=function a(b,c,d){var e=b.declare,f=(b.raise,b.raiseIf),g=b.Iterable,h=b.iterable,i=d.Game,j=(d.players.UserInterface,{__package__:"ludorum-game-mancala",__name__:"ludorum_game_mancala",__init__:a,__dependencies__:[b,c,d],__SERMAT__:{include:[b,d]}}),k=j.Mancala=e(i,{name:"Mancala",constructor:function(a,b){i.call(this,a),this.board=b||this.makeBoard()},makeBoard:function(a,b){a=isNaN(a)?4:+a,b=isNaN(b)?6:+b;for(var c=[],d=0;d<2;d++){for(var e=0;e<b;e++)c.push(a);c.push(0)}return c},players:["North","South"],emptyCapture:!1,countRemainingSeeds:!0,store:function(a){switch(this.players.indexOf(a)){case 0:return this.board.length/2-1;case 1:return this.board.length-1;default:throw new Error("Invalid player "+a+".")}},houses:function(a){switch(this.players.indexOf(a)){case 0:return g.range(0,this.board.length/2-1).toArray();case 1:return g.range(this.board.length/2,this.board.length-1).toArray();default:throw new Error("Invalid player "+a+".")}},oppositeHouse:function(a,b){var c=this.houses(a),d=this.houses(this.opponent(a)),e=c.indexOf(b);return e<0?e:d.reverse()[e]},nextSquare:function(a,b){do b=(b+1)%this.board.length;while(b===this.store(this.opponent(a)));return b},moves:function(){if(this.result())return null;var a=this.board,b={},c=this.activePlayer();return b[c]=this.houses(c).filter(function(b){return a[b]>0}),b[c].length>0?b:null},scores:function(){var a=this,b=this.board,c=this.players.map(function(c){return h(a.houses(c)).map(function(a){return b[a]}).sum()});if(c[0]>0&&c[1]>0)return null;var d={};return this.players.forEach(function(e,f){d[e]=b[a.store(e)]+a.countRemainingSeeds*c[f]}),d},result:function(){var a=this.scores(),b=this.players;return a&&this.zerosumResult(a[b[0]]-a[b[1]],b[0])},next:function(a,b,c){f(b,"Haps are not required (given ",b,")!");var d,e,g=this.activePlayer(),h=+a[g],i=this.board.slice(0),j=i[h],k=!1;for(f(j<1,"Invalid move ",h," for game ",this),i[h]=0;j>0;j--)h=this.nextSquare(g,h),i[h]++;k=h==this.store(g),k||(e=this.oppositeHouse(g,h),e>=0&&1==i[h]&&i[e]>0&&(d=this.store(g),i[d]++,i[h]=0,this.emptyCapture||(i[d]+=i[e],i[e]=0)));var l=k?g:this.opponent();return c?(this.activatePlayers(l),this.board=i,this):new this.constructor(l,i)},resultBounds:function(){var a=h(this.board).sum();return[-a,+a]},"static __SERMAT__":{identifier:j.__package__+".Mancala",serializer:function(a){return[a.activePlayer(),a.board]}},identifier:function(){return this.activePlayer().charAt(0)+this.board.map(function(a){return("00"+a.toString(36)).substr(-2)}).join("")},printBoard:function(){var a=this,c=b.Text.lpad,d=this.players[0],e=this.houses(d).map(function(b){return c(""+a.board[b],2,"0")}).reverse(),f=c(""+this.board[this.store(d)],2,"0"),g=this.players[1],h=this.houses(g).map(function(b){return c(""+a.board[b],2,"0")}),i=c(""+this.board[this.store(g)],2,"0");return"   "+e.join(" | ")+"   \n"+f+" ".repeat(2*e.length+3*(e.length-1)+2)+i+"\n   "+h.join(" | ")+"   "}});return k.makeBoard=k.prototype.makeBoard,d.games.Mancala=k,j.__SERMAT__.include.push(k),c.include(j),k.heuristics={fromWeights:function(a){function b(b,d){var e,f,g=0;switch(b.players.indexOf(d)){case 0:e=1;break;case 1:e=-1;break;default:throw new Error("Invalid player "+d+".")}return f=h(b.board).map(function(b,c){return g+=b,b*a[c]}).sum()/c/g*e}var c=h(a).map(Math.abs).sum();return b.weights=a,b}},k.heuristics.DEFAULT=k.heuristics.fromWeights([1,1,1,1,1,1,5,-1,-1,-1,-1,-1,-1,-5]),j}(b,c,d)}.call(f),function(){this["ludorum-game-reversi"]=function a(b,c,d){var e=b.declare,f=b.obj,g=(b.copy,b.raise),h=b.raiseIf,i=b.Iterable,j=b.iterable,k=d.Game,l=d.utils.Checkerboard,m=d.utils.CheckerboardFromString,n=(d.players.UserInterface,{__package__:"ludorum-game-reversi",__name__:"ludorum_game_reversi",__init__:a,__dependencies__:[b,c,d],__SERMAT__:{include:[b,d]}}),o=n.Reversi=e(k,{name:"Reversi",constructor:function(a,b){k.call(this,a),this.board=this.makeBoard.apply(this,b||[])},"dual makeBoard":function(a,b,c){return a=isNaN(a)?8:+a,b=isNaN(b)?8:+b,h(a<4||b<4||a%2||b%2,"An Reversi board must have even dimensions greater than 3."),"string"==typeof c?new m(a,b,c):new m(a,b)},players:["Black","White"],lines:function(a){return function(b,c){var d=b+"x"+c,e=a[d];return"undefined"==typeof e&&(e=a[d]=new l(b,c).lines().map(function(a){return a.toArray()},function(a){return a.length>2}).toArray()),e}}({}),__MOVE_REGEXPS__:{Black:[/\.W+B/g,/BW+\./g],White:[/\.B+W/g,/WB+\./g]},"dual boardCenter":function(a){a=a||this.board;var b=a.width,c=a.height;return[[c/2,b/2-1],[c/2-1,b/2],[c/2,b/2],[c/2-1,b/2-1]]},moves:function(a){if(a=a||this.activePlayer(),this.hasOwnProperty("__moves"+a+"__"))return this["__moves"+a+"__"];var b=this.board,c={},d=this.__MOVE_REGEXPS__[a],e=this.boardCenter().filter(function(a){return"."===b.square(a)});if(e.length<1){this.lines(b.height,b.width).forEach(function(a){d.forEach(function(d){b.asString(a).replace(d,function(b,d){var e="."===b.charAt(0)?a[d]:a[b.length-1+d];return c[e]=e,b})})});for(var g in c)e.push(c[g])}return e=e.length>0?f(a,e):null,arguments.length<1?this["__moves"+a+"__"]=e:e},validMoves:function(a){var b=this.moves();for(var c in b){if(!a.hasOwnProperty(c))return!1;var d=b[c].join("\n").indexOf(a[c]+"")>=0;if(!d)return!1}return!0},next:function(a,b,c){h(b,"Haps are not required (given ",b,")!"),this.validMoves(a)||g("Invalid moves "+JSON.stringify(a)+"!");var d,e,f=this.board.clone(),i=this.activePlayer(),j=a[i];return i==this.players[0]?(d="B",e=/^W+B/):(d="W",e=/^B+W/),this.boardCenter().join("\n").indexOf(j+"")>=0?f.__place__(j,d):f.walks(j,l.DIRECTIONS.EVERY).forEach(function(a){var b=e.exec(f.asString(a).substr(1));b&&a.toArray().slice(0,b[0].length).forEach(function(a){f.__place__(a,d)})}),c?(this.constructor(this.opponent(),[f.height,f.width,f.string]),this):new this.constructor(this.opponent(),[f.height,f.width,f.string])},result:function(){if(this.moves())return null;var a={W:-1,B:1},b=j(this.board.string).map(function(b){return a[b]||0}).sum();return this.zerosumResult(b,"Black")},resultBounds:function(){var a=this.board.width*this.board.height;return[-a,+a]},"static __SERMAT__":{identifier:n.__package__+".Reversi",serializer:function(a){return[a.activePlayer(),[a.board.height,a.board.width,a.board.string]]}}});d.games.Reversi=o,n.__SERMAT__.include.push(o);var p=n.Othello=e(o,{name:"Reversi",constructor:function(a,b){if(o.call(this,a,b),!this.moves()){var c=this.opponent();this.moves(c)&&(this.activePlayers=[c])}},"dual makeBoard":function(a,b,c){return a=isNaN(a)?8:+a,b=isNaN(b)?8:+b,h(a<4||b<4||a%2||b%2,"An Othello board must have even dimensions greater than 3."),"string"==typeof c?new m(a,b,c):new m(a,b).__place__([a/2,b/2-1],"W").__place__([a/2-1,b/2],"W").__place__([a/2,b/2],"B").__place__([a/2-1,b/2-1],"B")},"static __SERMAT__":{identifier:n.__package__+".Othello",serializer:function(a){return[a.activePlayer(),[a.board.height,a.board.width,a.board.string]]}}});d.games.Othello=p,n.__SERMAT__.include.push(p);var q=n.heuristics={heuristicFromWeights:function(a){var b=a.length,c=j(a).map(Math.abs).sum(),d=function(d,e){var f=d.board;return h(f.height*f.width!==b,"Wrong amount of weights!"),f.weightedSum(a,{W:"W"===e.charAt(0)?1:-1,B:"B"===e.charAt(0)?1:-1})/c};return d.weights=a,d},heuristicFromSymmetricWeights:function(a,b,c){b=isNaN(b)?8:0|b,c=isNaN(c)?8:0|c;var d=Math.ceil(b/2);return h(d*Math.ceil(c/2)>a.length,"Not enough weights!"),a=i.range(c).map(function(e){var f=e<c/2?e:c-e-1,g=f*d,h=(f+1)*d;return a.slice(g,h).concat(a.slice(g,h-b%2).reverse())}).flatten().toArray(),this.heuristicFromWeights(a)},pieceRatio:function(a,b){var c=0,d=0;return j(a.board.string).forEach(function(a){"."!==a&&(a===b.charAt(0)?++c:++d)}),(c-d)/(c+d)||0},mobilityRatio:function(a,b){var c=a.opponent(b),d=a.moves(b),e=a.moves(c),f=d&&d[b]&&d[b].length||0,g=e&&e[c]&&e[c].length||0;return(f-g)/(f+g)||0}};return q.defaultHeuristic=d.players.HeuristicPlayer.composite(q.heuristicFromSymmetricWeights([9,-3,3,3,-3,-3,-1,-1,3,-1,1,1,3,-1,1,1]),.6,q.pieceRatio,.2,q.mobilityRatio,.2),c.include(n),n}(b,c,d)}.call(f),e.mancala={Mancala:f["ludorum-game-mancala"].Mancala},e.colograph={Colograph:f["ludorum-game-colograph"].Colograph},e.connect4={ConnectFour:f["ludorum-game-connect4"].ConnectFour},e.reversi={Reversi:f["ludorum-game-reversi"].Reversi,Othello:f["ludorum-game-reversi"].Othello},e});
//# sourceMappingURL=ludorum-gamepack.min.js.map