//! ludorum-gamepack 0.1.2

(function(e){"use strict";"function"==typeof define&&define.amd?define(["creatartis-base","sermat","ludorum"],e):"object"==typeof exports&&module.exports?module.exports=e(require("creatartis-base"),require("sermat"),require("ludorum")):this["ludorum-gamepack"]=e(this.base,this.Sermat,this.ludorum)}).call(this,function e(t,r,n){"use strict";var i={__package__:"ludorum-gamepack",__name__:"ludorum_gamepack",__init__:e,__dependencies__:[t,r,n],__SERMAT__:{include:[t,n]}},a={base:t,Sermat:r,ludorum:n};return function(){this["ludorum-game-connect4"]=function e(t,r,n){var i=t.declare,a=(t.raise,t.raiseIf),s=(t.Iterable,t.iterable,n.Game,n.players.UserInterface,{__package__:"ludorum-game-connect4",__name__:"ludorum_game_connect4",__init__:e,__dependencies__:[t,r,n],__SERMAT__:{include:[t,n]}}),o=s.ConnectFour=i(n.games.ConnectionGame,{name:"ConnectFour",height:6,width:7,lineLength:4,players:["Yellow","Red"],moves:function(){var e=null;if(!this.result()){for(var t=[],r=this.board.string,n=(this.height-1)*this.width,i=0;i<r.length;++i)"."===r.charAt(n+i)&&t.push(i);t.length>0&&((e={})[this.activePlayer()]=t)}return e},next:function(e,t,r){a(t,"Haps are not required (given ",t,")!");for(var n=this.activePlayer(),i=this.board.string,s=+e[n],o=this.height,u=this.width,h=0;h<o;++h)if("."===i.charAt(h*u+s)){var c=n===this.players[0]?"0":"1";return r?(this.activatePlayers(this.opponent()),this.board.__place__([h,s],c),delete this.__moves__,delete this.__result__,this):new this.constructor(this.opponent(),this.board.place([h,s],c))}throw new Error("Invalid move "+JSON.stringify(e)+"!")},result:function(){for(var e=this.lineLength,t=this.board.asStrings(this.__lines__(this.height,this.width,e)).join(" "),r=0;r<this.players.length;++r)if(t.indexOf(r.toString(36).repeat(e))>=0)return this.victory([this.players[r]]);return t.indexOf(".")<0?this.tied():null},"static __SERMAT__":{identifier:"ConnectFour",serializer:function(e){return n.games.ConnectionGame.__SERMAT__.serializer(e)}}});return n.games.ConnectFour=o,o.__SERMAT__.identifier=s.__package__+"."+o.__SERMAT__.identifier,s.__SERMAT__.include.push(o),r.include(s),s}(t,r,n)}.call(a),function(){this["ludorum-game-colograph"]=function e(t,r,n){var i=t.declare,a=t.obj,s=(t.copy,t.raise,t.raiseIf),o=t.Iterable,u=t.iterable,h=n.Game,c=(n.players.UserInterface,{__package__:"ludorum-game-colograph",__name__:"ludorum_game_colograph",__init__:e,__dependencies__:[t,r,n],__SERMAT__:{include:[t,n]}}),l=c.Colograph=i(h,{name:"Colograph",constructor:function(e){h.call(this,e?e.activePlayer:void 0),t.initialize(this,e).object("colours",{defaultValue:{}}).array("edges",{defaultValue:[[1,3],[2],[3],[]]}).array("shapes",{defaultValue:["circle","triangle","square","star"]}).number("scoreSameShape",{defaultValue:-1,coerce:!0}).number("scoreDifferentShape",{defaultValue:-1,coerce:!0})},players:["Red","Blue"],score:function(){var e={},t=this.shapes,r=this.colours,n=this.scoreSameShape,i=this.scoreDifferentShape,a=this.edges.length;return this.players.forEach(function(t){e[t]=a}),u(this.edges).forEach(function(a,s){a.forEach(function(a){var o=s+","+a;r.hasOwnProperty(o)&&(e[r[o]]+=t[s]===t[a]?n:i)})}),e},result:function(){if(this.moves())return null;var e=this.score(),t=this.players;return this.zerosumResult(e[t[0]]-e[t[1]],t[0])},moves:function(){for(var e=this.colours,t=[],r=0,n=this.edges.length;r<n;r++)e.hasOwnProperty(r)||t.push(r);return t.length<1?null:a(this.activePlayer(),t)},next:function(e,t,r){s(t,"Haps are not required (given ",t,")!");var n=this.activePlayer(),i=0|e[n];s(i<0||i>=this.edges.length,"Invalid move: node ",i," does not exist in ",this,"."),s(this.colours.hasOwnProperty(i),"Invalid move: node ",i," has already been coloured in ",this,".");var o=Object.assign(a(i,n),this.colours);this.edges[i].forEach(function(e){o[e]===n&&(o[i+","+e]=n)}),this.edges.forEach(function(e,t){t!==i&&e.indexOf(i)>=0&&o[t]===n&&(o[t+","+i]=n)});var u={activePlayer:this.opponent(n),colours:o,edges:this.edges,shapes:this.shapes,scoreSameShape:this.scoreSameShape,scoreDifferentShape:this.scoreDifferentShape};return r?(this.constructor(u),this):new this.constructor(u)},"static __SERMAT__":{identifier:"Colograph",serializer:function(e){return[{activePlayer:e.activePlayer(),colours:e.colours,edges:e.edges,shapes:e.shapes,scoreSameShape:e.scoreSameShape,scoreDifferentShape:e.scoreDifferentShape}]}},edgeColour:function(e,t){var r=this.edges[e].indexOf(t)>=0||this.edges[t].indexOf(e)>=0,n=this.colours[e],i=this.colours[t];return r&&n>=0&&n===i?n:-1},"static randomGraph":function(e,t,r){e=Math.max(2,+e>>0),t=Math.max(e-1,+t>>0);for(var n,i,a=o.range(e-1).map(function(t){return r.split(1,o.range(t+1,e).toArray())}).toArray(),s=t-(e-1);s>0;s--)(n=r.choice(a))[1].length>0&&(i=r.split(1,n[1]),n[0].push(i[0][0]),n[1]=i[1],s--);return(a=a.map(function(e){return e[0]})).push([]),a},"static randomGame":function(e){return e=t.initialize({},e).object("random",{defaultValue:t.Randomness.DEFAULT}).integer("nodeCount",{defaultValue:8,coerce:!0}).integer("edgeCount",{defaultValue:11,coerce:!0}).integer("shapeCount",{defaultValue:4,coerce:!0,minimum:1,maximum:4}).array("shapes",{defaultValue:["circle","triangle","square","star"]}).subject,new this({edges:this.randomGraph(e.nodeCount,e.edgeCount,e.random),shapes:e.random.randoms(e.nodeCount,0,e.shapeCount).map(function(t){return e.shapes[0|t]}),scoreSameShape:1})}});return n.games.Colograph=l,l.__SERMAT__.identifier=c.__package__+"."+l.__SERMAT__.identifier,c.__SERMAT__.include.push(l),r.include(c),Object.assign(l.prototype,{circularArrangement:function(e){e=e||200;var t=2*Math.PI/this.edges.length;return this.edges.map(function(r,n){return[Math.round(e*Math.cos(t*n)),Math.round(e*Math.sin(t*n))]})},playerColour:function(e,t){return(t=t||this.playerColours)&&t[e]||e&&(e+"").toLowerCase()||""},__svgEnvelope__:function(e,t,r){return'<?xml version="1.0" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg height="'+t+'px" width="'+e+'px" version="1.1"\nxmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n'+(Array.isArray(r)?r.join("\n\t"):r)+"\n</svg>"},__svgStyles__:function(e){var t=this;return'<style type="text/css" ><![CDATA[\n\t.blank-node { stroke:black; stroke-width:2px; fill:white; }\n\t.blank-node:hover { stroke-width:4px; }\n\t.blank-edge { stroke:black; stroke-width:2px; }\n'+this.players.map(function(r){var n=t.playerColour(r,e);return"\t."+n+"-node { stroke:black; stroke-width:2px; fill:"+n+"}\n\t."+n+"-edge { stroke:"+n+"; stroke-width:2px }"}).join("\n")+"\t]]>\n\t</style>\n"},__svgDefs__:function(e){return e=e||30,["<defs>",this.__svgDefCircle__(e),this.__svgDefSquare__(e),this.__svgDefStar__(e),this.__svgDefTriangle__(e),this.__svgDefPentagon__(e),this.__svgDefHexagon__(e),"</defs>"].join("\n")},__svgDefPolygon__:function(e,t,r){return'\t<polygon id="'+e+'-node" points="'+(t=t.map(function(e){return[e[0]*r,e[1]*r]})).join(" ")+'"/>'},__svgDefCircle__:function(e){return'\t<circle id="circle-node" r="'+e/2+'px" cx="0" cy="0"/>'},__svgDefSquare__:function(e){return'\t<rect id="square-node" width="'+e+'px" height="'+e+'px" x="-'+e/2+'" y="-'+e/2+'"/>'},__svgDefTriangle__:function(e){return this.__svgDefPolygon__("triangle",[[-.5,.44],[0,-.44],[.5,.44]],e)},__svgDefStar__:function(e){return this.__svgDefPolygon__("star",[[0,-.48],[.12,-.1],[.5,-.1],[.2,.1],[.3,.48],[0,.26],[-.3,.48],[-.2,.1],[-.5,-.1],[-.12,-.1]],e)},__svgDefPentagon__:function(e){return this.__svgDefPolygon__("pentagon",[[0,-.48],[.5,-.1],[.3,.48],[-.3,.48],[-.5,-.1]],e)},__svgDefHexagon__:function(e){return this.__svgDefPolygon__("pentagon",[[0,-.5],[.42,-.24],[.42,.24],[0,.5],[-.42,.24],[-.42,-.24]],e)},toSVG:function(e,t,r,n){e=e||400,t=t||400,n=n||this.circularArrangement(Math.max(e,t)/2.5);var i=this,a=this.colours,s=[this.__svgStyles__(),this.__svgDefs__(r),'\t<g id="colograph" transform="translate('+e/2+","+t/2+')">'];this.edges.forEach(function(e,t){var r=n[t];e.forEach(function(e){var o=n[e],u=a[t+","+e],h=(i.playerColour(u)||"blank")+"-edge";s.push('\t<line class="'+h+'" x1="'+r[0]+'" y1="'+r[1]+'" x2="'+o[0]+'" y2="'+o[1]+'"/>')})});var o=this.shapes;return this.edges.forEach(function(e,t){var r=n[t],u=a[t],h=(i.playerColour(u)||"blank")+"-node";s.push('<use id="node'+t+'" xlink:href="#'+o[t]+'-node" transform="translate('+r.join(",")+')" class="'+h+'" data-ludorum-move="'+t+'"/>')}),s.push("\t</g>"),this.__svgEnvelope__(e,t,s)}}),l.heuristics={scoreDifference:function(e,t){var r=e.score(),n=0;for(var i in r)n+=i===t?r[i]:-r[i];return n/e.edges.length/2}},c}(t,r,n)}.call(a),function(){this["ludorum-game-mancala"]=function e(t,r,n){var i=t.declare,a=(t.raise,t.raiseIf),s=t.Iterable,o=t.iterable,u=n.Game,h=(n.players.UserInterface,{__package__:"ludorum-game-mancala",__name__:"ludorum_game_mancala",__init__:e,__dependencies__:[t,r,n],__SERMAT__:{include:[t,n]}}),c=h.Mancala=i(u,{name:"Mancala",constructor:function(e,t){u.call(this,e),this.board=t||this.makeBoard()},makeBoard:function(e,t){e=isNaN(e)?4:+e,t=isNaN(t)?6:+t;for(var r=[],n=0;n<2;n++){for(var i=0;i<t;i++)r.push(e);r.push(0)}return r},players:["North","South"],emptyCapture:!1,countRemainingSeeds:!0,store:function(e){switch(this.players.indexOf(e)){case 0:return this.board.length/2-1;case 1:return this.board.length-1;default:throw new Error("Invalid player "+e+".")}},houses:function(e){switch(this.players.indexOf(e)){case 0:return s.range(0,this.board.length/2-1).toArray();case 1:return s.range(this.board.length/2,this.board.length-1).toArray();default:throw new Error("Invalid player "+e+".")}},oppositeHouse:function(e,t){var r=this.houses(e),n=this.houses(this.opponent(e)),i=r.indexOf(t);return i<0?i:n.reverse()[i]},nextSquare:function(e,t){do{t=(t+1)%this.board.length}while(t===this.store(this.opponent(e)));return t},moves:function(){if(this.result())return null;var e=this.board,t={},r=this.activePlayer();return t[r]=this.houses(r).filter(function(t){return e[t]>0}),t[r].length>0?t:null},scores:function(){var e=this,t=this.board,r=this.players.map(function(r){return o(e.houses(r)).map(function(e){return t[e]}).sum()});if(r[0]>0&&r[1]>0)return null;var n={};return this.players.forEach(function(i,a){n[i]=t[e.store(i)]+e.countRemainingSeeds*r[a]}),n},result:function(){var e=this.scores(),t=this.players;return e&&this.zerosumResult(e[t[0]]-e[t[1]],t[0])},next:function(e,t,r){a(t,"Haps are not required (given ",t,")!");var n,i,s,o=this.activePlayer(),u=+e[o],h=this.board.slice(0),c=h[u];for(a(c<1,"Invalid move ",u," for game ",this),h[u]=0;c>0;c--)h[u=this.nextSquare(o,u)]++;(n=u==this.store(o))||(s=this.oppositeHouse(o,u))>=0&&1==h[u]&&h[s]>0&&(h[i=this.store(o)]++,h[u]=0,this.emptyCapture||(h[i]+=h[s],h[s]=0));var l=n?o:this.opponent();return r?(this.activatePlayers(l),this.board=h,this):new this.constructor(l,h)},resultBounds:function(){var e=o(this.board).sum();return[-e,+e]},"static __SERMAT__":{identifier:h.__package__+".Mancala",serializer:function(e){return[e.activePlayer(),e.board]}},identifier:function(){return this.activePlayer().charAt(0)+this.board.map(function(e){return("00"+e.toString(36)).substr(-2)}).join("")},printBoard:function(){var e=this,r=t.Text.lpad,n=this.players[0],i=this.houses(n).map(function(t){return r(""+e.board[t],2,"0")}).reverse(),a=r(""+this.board[this.store(n)],2,"0"),s=this.players[1],o=this.houses(s).map(function(t){return r(""+e.board[t],2,"0")}),u=r(""+this.board[this.store(s)],2,"0");return"   "+i.join(" | ")+"   \n"+a+" ".repeat(2*i.length+3*(i.length-1)+2)+u+"\n   "+o.join(" | ")+"   "}});return c.makeBoard=c.prototype.makeBoard,n.games.Mancala=c,h.__SERMAT__.include.push(c),r.include(h),c.heuristics={fromWeights:function(e){var t=o(e).map(Math.abs).sum();function r(r,n){var i,a=0;switch(r.players.indexOf(n)){case 0:i=1;break;case 1:i=-1;break;default:throw new Error("Invalid player "+n+".")}return o(r.board).map(function(t,r){return a+=t,t*e[r]}).sum()/t/a*i}return r.weights=e,r}},c.heuristics.DEFAULT=c.heuristics.fromWeights([1,1,1,1,1,1,5,-1,-1,-1,-1,-1,-1,-5]),h}(t,r,n)}.call(a),function(){this["ludorum-game-reversi"]=function e(t,r,n){var i,a=t.declare,s=t.obj,o=(t.copy,t.raise),u=t.raiseIf,h=t.Iterable,c=t.iterable,l=n.Game,_=n.utils.Checkerboard,d=n.utils.CheckerboardFromString,f=(n.players.UserInterface,{__package__:"ludorum-game-reversi",__name__:"ludorum_game_reversi",__init__:e,__dependencies__:[t,r,n],__SERMAT__:{include:[t,n]}}),g=f.Reversi=a(l,{name:"Reversi",constructor:function(e,t){l.call(this,e),this.board=this.makeBoard.apply(this,t||[])},"dual makeBoard":function(e,t,r){return e=isNaN(e)?8:+e,t=isNaN(t)?8:+t,u(e<4||t<4||e%2||t%2,"An Reversi board must have even dimensions greater than 3."),"string"==typeof r?new d(e,t,r):new d(e,t)},players:["Black","White"],lines:(i={},function(e,t){var r=e+"x"+t,n=i[r];return void 0===n&&(n=i[r]=new _(e,t).lines().map(function(e){return e.toArray()},function(e){return e.length>2}).toArray()),n}),__MOVE_REGEXPS__:{Black:[/\.W+B/g,/BW+\./g],White:[/\.B+W/g,/WB+\./g]},"dual boardCenter":function(e){var t=(e=e||this.board).width,r=e.height;return[[r/2,t/2-1],[r/2-1,t/2],[r/2,t/2],[r/2-1,t/2-1]]},moves:function(e){if(e=e||this.activePlayer(),this.hasOwnProperty("__moves"+e+"__"))return this["__moves"+e+"__"];var t=this.board,r={},n=this.__MOVE_REGEXPS__[e],i=this.boardCenter().filter(function(e){return"."===t.square(e)});if(i.length<1)for(var a in this.lines(t.height,t.width).forEach(function(e){n.forEach(function(n){t.asString(e).replace(n,function(t,n){var i="."===t.charAt(0)?e[n]:e[t.length-1+n];return r[i]=i,t})})}),r)i.push(r[a]);return i=i.length>0?s(e,i):null,arguments.length<1?this["__moves"+e+"__"]=i:i},validMoves:function(e){var t=this.moves();for(var r in t){if(!e.hasOwnProperty(r))return!1;if(!(t[r].join("\n").indexOf(e[r]+"")>=0))return!1}return!0},next:function(e,t,r){u(t,"Haps are not required (given ",t,")!"),this.validMoves(e)||o("Invalid moves "+JSON.stringify(e)+"!");var n,i,a=this.board.clone(),s=this.activePlayer(),h=e[s];return s==this.players[0]?(n="B",i=/^W+B/):(n="W",i=/^B+W/),this.boardCenter().join("\n").indexOf(h+"")>=0?a.__place__(h,n):a.walks(h,_.DIRECTIONS.EVERY).forEach(function(e){var t=i.exec(a.asString(e).substr(1));t&&e.toArray().slice(0,t[0].length).forEach(function(e){a.__place__(e,n)})}),r?(this.constructor(this.opponent(),[a.height,a.width,a.string]),this):new this.constructor(this.opponent(),[a.height,a.width,a.string])},result:function(){if(this.moves())return null;var e={W:-1,B:1},t=c(this.board.string).map(function(t){return e[t]||0}).sum();return this.zerosumResult(t,"Black")},resultBounds:function(){var e=this.board.width*this.board.height;return[-e,+e]},"static __SERMAT__":{identifier:f.__package__+".Reversi",serializer:function(e){return[e.activePlayer(),[e.board.height,e.board.width,e.board.string]]}}});n.games.Reversi=g,f.__SERMAT__.include.push(g);var p=f.Othello=a(g,{name:"Reversi",constructor:function(e,t){if(g.call(this,e,t),!this.moves()){var r=this.opponent();this.moves(r)&&(this.activePlayers=[r])}},"dual makeBoard":function(e,t,r){return e=isNaN(e)?8:+e,t=isNaN(t)?8:+t,u(e<4||t<4||e%2||t%2,"An Othello board must have even dimensions greater than 3."),"string"==typeof r?new d(e,t,r):new d(e,t).__place__([e/2,t/2-1],"W").__place__([e/2-1,t/2],"W").__place__([e/2,t/2],"B").__place__([e/2-1,t/2-1],"B")},"static __SERMAT__":{identifier:f.__package__+".Othello",serializer:function(e){return[e.activePlayer(),[e.board.height,e.board.width,e.board.string]]}}});n.games.Othello=p,f.__SERMAT__.include.push(p);var m=f.heuristics={heuristicFromWeights:function(e){var t=e.length,r=c(e).map(Math.abs).sum(),n=function(n,i){var a=n.board;return u(a.height*a.width!==t,"Wrong amount of weights!"),a.weightedSum(e,{W:"W"===i.charAt(0)?1:-1,B:"B"===i.charAt(0)?1:-1})/r};return n.weights=e,n},heuristicFromSymmetricWeights:function(e,t,r){t=isNaN(t)?8:0|t,r=isNaN(r)?8:0|r;var n=Math.ceil(t/2);return u(n*Math.ceil(r/2)>e.length,"Not enough weights!"),e=h.range(r).map(function(i){var a=i<r/2?i:r-i-1,s=a*n,o=(a+1)*n;return e.slice(s,o).concat(e.slice(s,o-t%2).reverse())}).flatten().toArray(),this.heuristicFromWeights(e)},pieceRatio:function(e,t){var r=0,n=0;return c(e.board.string).forEach(function(e){"."!==e&&(e===t.charAt(0)?++r:++n)}),(r-n)/(r+n)||0},mobilityRatio:function(e,t){var r=e.opponent(t),n=e.moves(t),i=e.moves(r),a=n&&n[t]&&n[t].length||0,s=i&&i[r]&&i[r].length||0;return(a-s)/(a+s)||0}};return m.defaultHeuristic=n.players.HeuristicPlayer.composite(m.heuristicFromSymmetricWeights([9,-3,3,3,-3,-3,-1,-1,3,-1,1,1,3,-1,1,1]),.6,m.pieceRatio,.2,m.mobilityRatio,.2),r.include(f),f}(t,r,n)}.call(a),i.mancala={Mancala:a["ludorum-game-mancala"].Mancala},i.colograph={Colograph:a["ludorum-game-colograph"].Colograph},i.connect4={ConnectFour:a["ludorum-game-connect4"].ConnectFour},i.reversi={Reversi:a["ludorum-game-reversi"].Reversi,Othello:a["ludorum-game-reversi"].Othello},i});
//# sourceMappingURL=ludorum-gamepack.min.js.map